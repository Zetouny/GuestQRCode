<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="public/favicon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="public/favicon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="public/favicon/favicon-16x16.png"
    />
    <link rel="manifest" href="public/favicon/site.webmanifest" />
    <title>Porsche Iftar</title>
  </head>
  <body>
    <img id="logo" src="public/logo-porsche.png" />
    <h1>4th of March, Porsche Iftar</h1>
    <h2>Visitor QR Code</h2>
    <p>
      A unique QR code has been generated just for you. Scan it at the entrance
      to grant access.
    </p>

    <div id="qr-box">
      <img id="qr-img" src="" alt="QR Code" />
      <span>Your Visitor Code</span>
      <div id="visitor-code" class="visitor-code">------</div>
    </div>

    <script>
      async function loadQR() {
        let storedId = localStorage.getItem("visitorId");
        const isValid = /^[A-Z0-9]{6}$/.test((storedId || "").toUpperCase());

        if (!isValid) {
          localStorage.removeItem("visitorId");
          storedId = null;
        }

        const url = storedId ? "/api/qr?vid=" + storedId : "/api/qr";
        const res = await fetch(url);
        const data = await res.json();

        localStorage.setItem("visitorId", data.visitorId);
        document.getElementById("qr-img").src = data.qr;
        document.getElementById("visitor-code").textContent = data.visitorId;
      }

      loadQR();
    </script>
  </body>
</html>
